<div class="posts">
  <div class="filter">
    <nb-card>
      <nb-card-header>Profile</nb-card-header>
      <nb-card-body>
        <nb-select 
          fullWidth 
          placeholder="All" 
          size="medium" 
          [selected]="username" 
          (selectedChange)="selectedProfileChanged($event)"
        >
          <nb-option>All</nb-option>
          <nb-option *ngFor="let profile of profileService.profiles" [value]="profile.username">{{ profile.display_name }}</nb-option>
        </nb-select>
      </nb-card-body>
    </nb-card>
    <nb-card>
      <nb-card-header>Time Range</nb-card-header>
      <nb-card-body>
        <nb-select 
          fullWidth 
          placeholder="All" 
          size="medium"
          [selected]="year" 
          (selectedChange)="selectedYearChanged($event)"
        >
          <nb-option>All</nb-option>
          <nb-option value="2021">2021</nb-option>
          <nb-option value="2020">2020</nb-option>
          <nb-option value="2019">2019</nb-option>
        </nb-select>
      </nb-card-body>
    </nb-card>
  </div>
  <div class="list">
    <nb-list nbInfiniteList [threshold]="1500" [listenWindowScroll]="true" (bottomThreshold)="loadNext()">
      <nb-list-item *ngFor="let post of posts; let postIndex=index;">
        <nb-card>
          <div *ngFor="let item of post.items; let itemIndex=index;" class="media">
            <img *ngIf="item.type == 'image'" loading="lazy" [src]="postService.getMediaPath(post.owner_username, item.filename)">
            <video *ngIf="item.type == 'video'" preload="none" controls muted [poster]="postService.getPosterPath(post.owner_username, item.thumb_image_filename)">
              <source [src]="postService.getMediaPath(post.owner_username, item.filename)" type="video/mp4">
            </video>
            <button nbButton (click)="delete(post, item, postIndex, itemIndex)"><nb-icon icon="trash-2-outline"></nb-icon></button>
          </div>
          <nb-accordion>
            <nb-accordion-item>
              <nb-accordion-item-header>
                <div>
                  <div><b>{{ this.profileService.display_names.get(post.owner_username) }}</b></div>
                  <div>{{ post.creation_time | date:'medium' }}</div>
                </div>
              </nb-accordion-item-header>
              <nb-accordion-item-body>
                <div>{{ post.caption }}</div>
              </nb-accordion-item-body>
            </nb-accordion-item>
          </nb-accordion>
        </nb-card>
      </nb-list-item>
    </nb-list>
  </div>
</div>